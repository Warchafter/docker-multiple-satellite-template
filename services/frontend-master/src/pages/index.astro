---
import ExampleComponent from '../components/ExampleComponent.tsx';
import { ProductCard } from '../components/ProductCard';
import '../styles/global.css'; // Import CSS this way

// Use the same environment variable approach as before
const API = process.env.PUBLIC_WP_API || import.meta.env.PUBLIC_WP_API || 'http://master-backend:80/wp-json/wp/v2';

console.log('API URL:', API); // Debug log

let posts = [];
try {
  const res = await fetch(`${API}/posts?_embed`);
  if (res.ok) {
    posts = await res.json();
    console.log("posts: ", posts);
  } else {
    console.error('Failed to fetch posts:', res.status, res.statusText);
  }
} catch (error) {
  console.error('Error fetching posts:', error);
  posts = []; // Fallback to empty array
}
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Astro SSR</title>
  </head>
  <body class="prose mx-auto p-4">
    <h1 class="text-3xl font-bold">Welcome to Astro + React + TS + Tailwind</h1>
    <h1>Your Blog</h1>
    
    {posts.length > 0 ? (
      posts.map((post: any) => (
        <article key={post.id}>
          <h2 set:html={post.title.rendered}></h2>
          <div set:html={post.excerpt.rendered}></div>
          <a href={`/${post.slug}`}>Read more</a>
        </article>
      ))
    ) : (
      <p>No posts available or unable to connect to WordPress API.</p>
    )}
    <ProductCard productId={13}/>
    <ExampleComponent />
  </body>
</html>