---
const { slug } = Astro.params;

if (slug === 'favicon.ico' || slug?.includes('.')) {
  return new Response('Not Found', { status: 404 });
}

// Use the same environment variable approach as index.astro
const API = process.env.PUBLIC_WP_API || import.meta.env.PUBLIC_WP_API || 'http://master-backend:80/wp-json/wp/v2';

console.log('API URL in [slug]:', API); // Debug log

let post = null;
try {
  const res = await fetch(`${API}/posts?slug=${slug}&_embed`);
  if (res.ok) {
    const posts = await res.json();
    post = posts[0]; // WordPress returns an array, get the first post
  } else {
    console.error('Failed to fetch post:', res.status, res.statusText);
  }
} catch (error) {
  console.error('Error fetching post:', error);
}

if (!post) {
  throw new Error('Post not found');
}
---

<html>
  <head>
    <title set:html={post.title.rendered}></title>
  </head>
  <body class="prose mx-auto p-4">
    <h1 set:html={post.title.rendered}></h1>
    <div set:html={post.content.rendered}></div>
    <a href="/">‚Üê Back to posts</a>
  </body>
</html>